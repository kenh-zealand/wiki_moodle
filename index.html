<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tank Duel</title>
  <style>
    :root {
      color-scheme: dark;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #0f1115;
      color: #eef1f6;
      display: grid;
      place-items: center;
      min-height: 100vh;
    }

    .game-shell {
      width: min(920px, 92vw);
      background: #171a22;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.45);
      display: grid;
      gap: 16px;
    }

    h1 {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.5px;
    }

    .hud {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 24px;
      font-size: 0.95rem;
      opacity: 0.85;
    }

    .arena {
      position: relative;
    }

    canvas {
      width: 100%;
      height: auto;
      background: radial-gradient(circle at top, #243047, #151a28 70%);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: block;
    }

    .overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      font-size: 1.1rem;
      background: rgba(13, 16, 24, 0.6);
      border-radius: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .overlay.visible {
      opacity: 1;
    }

    .controls {
      font-size: 0.9rem;
      opacity: 0.7;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(79, 164, 255, 0.2);
      border: 1px solid rgba(79, 164, 255, 0.5);
      color: #cfe4ff;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="game-shell">
    <h1>Tank Duel</h1>
    <div class="hud">
      <div>Spiller liv: <span id="player-health" class="badge">3</span></div>
      <div>Fjende liv: <span id="enemy-health" class="badge">3</span></div>
      <div>Status: <span id="status" class="badge">Klar</span></div>
    </div>
    <div class="arena">
      <canvas id="game" width="860" height="520" aria-label="Tankspil"></canvas>
      <div id="overlay" class="overlay">Tryk R for at starte igen</div>
    </div>
    <div class="controls">Styring: WASD for at bev√¶ge tanken, Mellemrum for at skyde.</div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const playerHealthEl = document.getElementById("player-health");
    const enemyHealthEl = document.getElementById("enemy-health");
    const statusEl = document.getElementById("status");
    const overlayEl = document.getElementById("overlay");

    const keys = new Set();
    const bullets = [];

    const arena = {
      width: canvas.width,
      height: canvas.height,
    };

    const playerTemplate = {
      x: 160,
      y: 320,
      size: 38,
      speed: 2.4,
      angle: 0,
      health: 3,
      cooldown: 0,
      color: "#54d38c",
    };

    const enemyTemplate = {
      x: 680,
      y: 180,
      size: 38,
      speed: 1.6,
      angle: Math.PI,
      health: 3,
      cooldown: 0,
      color: "#ff6b6b",
      target: { x: 650, y: 140 },
    };

    let player = { ...playerTemplate };
    let enemy = { ...enemyTemplate, target: { ...enemyTemplate.target } };

    function clamp(value, min, max) {
      return Math.max(min, Math.min(max, value));
    }

    function distance(a, b) {
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      return Math.hypot(dx, dy);
    }

    function resetGame() {
      player = { ...playerTemplate };
      enemy = { ...enemyTemplate, target: { ...enemyTemplate.target } };
      bullets.length = 0;
      updateHUD();
      overlayEl.classList.remove("visible");
    }

    function updatePlayer() {
      let dx = 0;
      let dy = 0;
      if (keys.has("w")) dy -= 1;
      if (keys.has("s")) dy += 1;
      if (keys.has("a")) dx -= 1;
      if (keys.has("d")) dx += 1;

      const magnitude = Math.hypot(dx, dy) || 1;
      const velocityX = (dx / magnitude) * player.speed;
      const velocityY = (dy / magnitude) * player.speed;

      player.x = clamp(player.x + velocityX, player.size, arena.width - player.size);
      player.y = clamp(player.y + velocityY, player.size, arena.height - player.size);

      if (dx || dy) {
        player.angle = Math.atan2(dy, dx);
      }

      if (player.cooldown > 0) {
        player.cooldown -= 1;
      }
    }

    function updateEnemy() {
      if (distance(enemy, enemy.target) < 40) {
        enemy.target = {
          x: clamp(200 + Math.random() * 460, enemy.size, arena.width - enemy.size),
          y: clamp(80 + Math.random() * 360, enemy.size, arena.height - enemy.size),
        };
      }

      const dx = enemy.target.x - enemy.x;
      const dy = enemy.target.y - enemy.y;
      const magnitude = Math.hypot(dx, dy) || 1;
      enemy.x = clamp(enemy.x + (dx / magnitude) * enemy.speed, enemy.size, arena.width - enemy.size);
      enemy.y = clamp(enemy.y + (dy / magnitude) * enemy.speed, enemy.size, arena.height - enemy.size);
      enemy.angle = Math.atan2(player.y - enemy.y, player.x - enemy.x);

      if (enemy.cooldown > 0) {
        enemy.cooldown -= 1;
      } else if (distance(player, enemy) < 420) {
        fireBullet(enemy, 3.4, "enemy");
        enemy.cooldown = 70;
      }
    }

    function fireBullet(tank, speed, owner) {
      const barrelLength = tank.size * 0.9;
      bullets.push({
        x: tank.x + Math.cos(tank.angle) * barrelLength,
        y: tank.y + Math.sin(tank.angle) * barrelLength,
        radius: 4,
        angle: tank.angle,
        speed,
        owner,
        life: 160,
      });
    }

    function updateBullets() {
      for (let i = bullets.length - 1; i >= 0; i -= 1) {
        const bullet = bullets[i];
        bullet.x += Math.cos(bullet.angle) * bullet.speed;
        bullet.y += Math.sin(bullet.angle) * bullet.speed;
        bullet.life -= 1;

        if (
          bullet.life <= 0 ||
          bullet.x < -20 ||
          bullet.y < -20 ||
          bullet.x > arena.width + 20 ||
          bullet.y > arena.height + 20
        ) {
          bullets.splice(i, 1);
          continue;
        }

        const target = bullet.owner === "player" ? enemy : player;
        if (distance(bullet, target) < target.size * 0.7) {
          bullets.splice(i, 1);
          target.health -= 1;
          updateHUD();
        }
      }
    }

    function updateHUD() {
      playerHealthEl.textContent = player.health;
      enemyHealthEl.textContent = enemy.health;
      if (player.health <= 0) {
        statusEl.textContent = "Du tabte!";
        overlayEl.classList.add("visible");
      } else if (enemy.health <= 0) {
        statusEl.textContent = "Du vandt!";
        overlayEl.classList.add("visible");
      } else {
        statusEl.textContent = "Kamp i gang";
      }
    }

    function drawTank(tank, turretColor) {
      ctx.save();
      ctx.translate(tank.x, tank.y);
      ctx.rotate(tank.angle);

      ctx.fillStyle = tank.color;
      ctx.strokeStyle = "rgba(0,0,0,0.4)";
      ctx.lineWidth = 2;

      ctx.beginPath();
      ctx.roundRect(-tank.size * 0.7, -tank.size * 0.5, tank.size * 1.4, tank.size, 6);
      ctx.fill();
      ctx.stroke();

      ctx.fillStyle = turretColor;
      ctx.beginPath();
      ctx.roundRect(-tank.size * 0.2, -tank.size * 0.25, tank.size * 0.7, tank.size * 0.5, 4);
      ctx.fill();

      ctx.fillStyle = "#f5f5f5";
      ctx.fillRect(tank.size * 0.2, -4, tank.size * 0.8, 8);

      ctx.restore();
    }

    function drawBullets() {
      for (const bullet of bullets) {
        ctx.beginPath();
        ctx.fillStyle = bullet.owner === "player" ? "#7ef6ff" : "#ffd166";
        ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawArena() {
      ctx.clearRect(0, 0, arena.width, arena.height);

      ctx.strokeStyle = "rgba(255,255,255,0.07)";
      ctx.lineWidth = 1;
      for (let i = 60; i < arena.width; i += 80) {
        ctx.beginPath();
        ctx.moveTo(i, 20);
        ctx.lineTo(i, arena.height - 20);
        ctx.stroke();
      }
      for (let i = 60; i < arena.height; i += 80) {
        ctx.beginPath();
        ctx.moveTo(20, i);
        ctx.lineTo(arena.width - 20, i);
        ctx.stroke();
      }

      ctx.fillStyle = "rgba(255,255,255,0.07)";
      ctx.beginPath();
      ctx.arc(arena.width * 0.5, arena.height * 0.5, 110, 0, Math.PI * 2);
      ctx.fill();
    }

    function gameLoop() {
      if (player.health > 0 && enemy.health > 0) {
        updatePlayer();
        updateEnemy();
        updateBullets();
      }

      drawArena();
      drawBullets();
      drawTank(player, "#2a9d8f");
      drawTank(enemy, "#e76f51");

      requestAnimationFrame(gameLoop);
    }

    window.addEventListener("keydown", (event) => {
      const key = event.key.toLowerCase();
      if (["w", "a", "s", "d", " ", "r"].includes(key)) {
        event.preventDefault();
      }
      keys.add(key);
      if (key === " " && player.cooldown <= 0 && player.health > 0 && enemy.health > 0) {
        fireBullet(player, 4.2, "player");
        player.cooldown = 18;
      }
      if (key === "r" && (player.health <= 0 || enemy.health <= 0)) {
        resetGame();
      }
    });

    window.addEventListener("keyup", (event) => {
      keys.delete(event.key.toLowerCase());
    });

    updateHUD();
    gameLoop();
  </script>
</body>
</html>
